![Logo](logo.png)

# RPI-Custom-Imager

ğŸš€ ç®€å•å¯é çš„æ ‘è“æ´¾ç³»ç»Ÿå®šåˆ¶å†™å…¥å·¥å…·

## ç‰¹ç‚¹

- âœ… å•ä¸€é…ç½®æ–‡ä»¶ï¼Œç®€å•æ˜“ç”¨
- âœ… äº¤äº’å¼é€‰æ‹© U ç›˜
- âœ… å†™å…¥è¿›åº¦å®æ—¶æ˜¾ç¤ºï¼ˆç™¾åˆ†æ¯” + ETAï¼‰
- âœ… å¯é€‰æ ¡éªŒç¡®ä¿æ•°æ®å®Œæ•´
- âœ… è‡ªåŠ¨é…ç½®ç”¨æˆ·ã€WiFiã€SSHã€æ—¶åŒº
- âœ… è‡ªåŠ¨å®‰è£… pvï¼ˆè¿›åº¦æ¡å·¥å…·ï¼‰
- âœ… é’ˆå¯¹ Raspberry Pi 4B + Trixie ä¼˜åŒ–

## å¿«é€Ÿå¼€å§‹

### 1. é…ç½®

```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
cp config.sample.sh config.sh

# ç¼–è¾‘é…ç½®ï¼ˆåŒ…å«æ‰€æœ‰è®¾ç½®ï¼‰
nano config.sh
```

### 2. ä¸‹è½½é•œåƒ

**æ‰‹åŠ¨ä¸‹è½½é•œåƒåˆ° `images/` ç›®å½•ï¼š**

```bash
cd images/

# æ–¹æ³• 1: ä½¿ç”¨ wget
wget https://downloads.raspberrypi.org/raspios_testing_arm64/images/raspios_testing_arm64-2024-12-05/2024-12-05-raspios-trixie-arm64.img.xz

# æ–¹æ³• 2: ä½¿ç”¨æµè§ˆå™¨ä¸‹è½½åå¤åˆ¶
cp ~/Downloads/2024-12-05-raspios-trixie-arm64.img.xz .

# æ–¹æ³• 3: å¦‚æœå·²æœ‰ .img æ–‡ä»¶ï¼Œç›´æ¥å¤åˆ¶
cp ~/Downloads/raspios.img .

cd ..
```

**é•œåƒä¸‹è½½åœ°å€ï¼š**
- Raspberry Pi OS (Trixie 64-bit): https://downloads.raspberrypi.org/raspios_testing_arm64/images/
- Raspberry Pi OS (Bookworm 64-bit): https://downloads.raspberrypi.org/raspios_arm64/images/
- Raspberry Pi OS Lite: https://downloads.raspberrypi.org/raspios_lite_arm64/images/

### 3. å†™å…¥

```bash
# è¿è¡Œè„šæœ¬ï¼Œä¼šè‡ªåŠ¨æ˜¾ç¤ºå¯ç”¨ U ç›˜ä¾›é€‰æ‹©
sudo ./write-image.sh

# æˆ–ç›´æ¥æŒ‡å®šè®¾å¤‡
sudo ./write-image.sh /dev/sdX
```

## é…ç½®è¯´æ˜

åªéœ€ç¼–è¾‘ `config.sh`ï¼ŒåŒ…å«æ‰€æœ‰é…ç½®ï¼š

### åŸºæœ¬é…ç½®

| å˜é‡ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `HOSTNAME` | ä¸»æœºå | `raspberrypi` |
| `USERNAME` | ç”¨æˆ·å | `pi` |
| `USER_PASSWORD` | ç”¨æˆ·å¯†ç  | `your_password` |
| `TIMEZONE` | æ—¶åŒº | `Asia/Shanghai` |
| `LOCALE` | è¯­è¨€ç¯å¢ƒ | `en_US.UTF-8` |
| `KEYBOARD_LAYOUT` | é”®ç›˜å¸ƒå±€ | `us` |
| `ENABLE_SSH` | å¯ç”¨ SSH | `true` / `false` |

### WiFi é…ç½®ï¼ˆå¯é€‰ï¼‰

| å˜é‡ | è¯´æ˜ |
|------|------|
| `WIFI_SSID` | WiFi åç§°ï¼ˆç•™ç©ºåˆ™ä¸é…ç½®ï¼‰ |
| `WIFI_PASSWORD` | WiFi å¯†ç  |
| `WIFI_COUNTRY` | WiFi å›½å®¶ä»£ç  (`CN`, `US` ç­‰) |

### é«˜çº§é…ç½®

| å˜é‡ | è¯´æ˜ |
|------|------|
| `SSH_PUBLIC_KEY` | SSH å…¬é’¥ï¼ˆå¯é€‰ï¼‰ |
| `EXTRA_PACKAGES` | é¢å¤–å®‰è£…çš„è½¯ä»¶åŒ… |
| `REGION_CODE` | åŒºåŸŸä»£ç  |

## å¸¸è§æ—¶åŒº

```bash
Asia/Shanghai       # ä¸­å›½
America/New_York    # ç¾å›½ä¸œéƒ¨
America/Los_Angeles # ç¾å›½è¥¿éƒ¨
Europe/London       # è‹±å›½
America/Toronto     # åŠ æ‹¿å¤§

# æŸ¥çœ‹æ‰€æœ‰æ—¶åŒº
timedatectl list-timezones
```

## å®‰å…¨æç¤º

âš ï¸ **æ°¸è¿œä¸è¦å°† `config.sh` æäº¤åˆ° Gitï¼**

è¯¥æ–‡ä»¶å·²åœ¨ `.gitignore` ä¸­ï¼Œä½†è¯·åŠ¡å¿…ï¼š

1. ä¿®æ”¹å‰å…ˆ `git status` æ£€æŸ¥
2. å®šæœŸå¤‡ä»½é…ç½®åˆ°å®‰å…¨ä½ç½®
3. ä½¿ç”¨å¼ºå¯†ç ï¼ˆè‡³å°‘ 8 ä½ï¼‰

## å†™å…¥è¿‡ç¨‹

è„šæœ¬ä¼šæ˜¾ç¤ºè¯¦ç»†çš„è¿›åº¦ä¿¡æ¯ï¼š

### 1. å†™å…¥é˜¶æ®µ

**å®‰è£…äº† pv (æ¨è):**
```
æ­£åœ¨å†™å…¥é•œåƒ...
4.00GiB 0:03:12 [20.8MiB/s] [=========>          ] 45% ETA 0:03:55
```
æ˜¾ç¤ºä¿¡æ¯ï¼š
- å·²å†™å…¥å¤§å°
- å·²ç”¨æ—¶é—´
- å½“å‰é€Ÿåº¦
- **ç™¾åˆ†æ¯”è¿›åº¦æ¡**
- é¢„è®¡å‰©ä½™æ—¶é—´ (ETA)

**æœªå®‰è£… pv (åŸºç¡€æ¨¡å¼):**
```
æ­£åœ¨å†™å…¥é•œåƒ...
4294967296 bytes (4.3 GB) copied, 180 s, 23.9 MB/s
```

### 2. æ ¡éªŒé˜¶æ®µï¼ˆå¯é€‰ä½†æ¨èï¼‰

**å®‰è£…äº† pv:**
```
[1/2] è®¡ç®—é•œåƒæ ¡éªŒå’Œ...
4.00GiB 0:01:30 [45.2MiB/s] [==================>] 100%
âœ“ é•œåƒ SHA256: 8a3f2d1e...

[2/2] è®¡ç®—è®¾å¤‡æ ¡éªŒå’Œ...
4.00GiB 0:02:15 [30.1MiB/s] [==================>] 100%
âœ“ è®¾å¤‡ SHA256: 8a3f2d1e...

âœ“ æ ¡éªŒé€šè¿‡ï¼æ•°æ®å®Œæ•´æ— è¯¯
```

**æœªå®‰è£… pv:**
æ˜¾ç¤ºåŸºæœ¬è¿›åº¦ä¿¡æ¯ï¼Œä½†æ²¡æœ‰ç™¾åˆ†æ¯”å’Œ ETAã€‚

### 3. é…ç½®é˜¶æ®µ
```
æŒ‚è½½ boot åˆ†åŒº...
âœ“ ç”¨æˆ·é…ç½®å·²åˆ›å»º
âœ“ WiFi å·²é…ç½®
âœ“ SSH å·²å¯ç”¨
```

## ä¸‹è½½é•œåƒ

### å®˜æ–¹é•œåƒä¸‹è½½åœ°å€

**Raspberry Pi OS Trixie (Debian 13, 64-bit)** - æ¨èç”¨äº Pi 4B
- ç´¢å¼•é¡µ: https://downloads.raspberrypi.org/raspios_testing_arm64/images/
- é€‰æ‹©æœ€æ–°æ—¥æœŸçš„æ–‡ä»¶å¤¹ï¼Œä¸‹è½½ `.img.xz` æ–‡ä»¶

**Raspberry Pi OS Bookworm (Debian 12, 64-bit)** - ç¨³å®šç‰ˆ
- ç´¢å¼•é¡µ: https://downloads.raspberrypi.org/raspios_arm64/images/

**Raspberry Pi OS Lite** - æ— æ¡Œé¢ç‰ˆæœ¬
- ç´¢å¼•é¡µ: https://downloads.raspberrypi.org/raspios_lite_arm64/images/

### ä¸‹è½½æ–¹æ³•

```bash
cd images/

# ä½¿ç”¨ wgetï¼ˆæ¨èï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼‰
wget -c https://downloads.raspberrypi.org/.../xxx.img.xz

# ä½¿ç”¨ curl
curl -L -O -C - https://downloads.raspberrypi.org/.../xxx.img.xz

# æˆ–ä½¿ç”¨æµè§ˆå™¨ä¸‹è½½åå¤åˆ¶åˆ°æ­¤ç›®å½•
cp ~/Downloads/xxx.img.xz .
```

### æ”¯æŒçš„æ ¼å¼

- âœ… `.img` - æœªå‹ç¼©é•œåƒ
- âœ… `.img.xz` - xz å‹ç¼©ï¼ˆæ¨èï¼Œä½“ç§¯å°ï¼‰
- âœ… `.img.zip` - zip å‹ç¼©

è„šæœ¬ä¼šè‡ªåŠ¨è§£å‹ç¼©å¹¶å†™å…¥ã€‚

## è‡ªåŠ¨å®‰è£…ä¾èµ–

è„šæœ¬ä¼šè‡ªåŠ¨æ£€æŸ¥å¹¶å®‰è£… `pv`ï¼ˆè¿›åº¦æ¡å·¥å…·ï¼‰ï¼š

```
æ£€æŸ¥ç³»ç»Ÿä¾èµ–...
âœ“ dd å·²å®‰è£…
âœ“ mount å·²å®‰è£…
âš  pv æœªå®‰è£… (ç”¨äºæ˜¾ç¤ºè¿›åº¦æ¡)
â„¹ æ­£åœ¨è‡ªåŠ¨å®‰è£… pv...
âœ“ pv å®‰è£…æˆåŠŸ
```

å¦‚æœè‡ªåŠ¨å®‰è£…å¤±è´¥ï¼Œæ‰‹åŠ¨å®‰è£…ï¼š
```bash
sudo apt install pv
```

## æ•…éšœæ’é™¤

### å†™å…¥é€Ÿåº¦æ…¢

- USB 2.0 æ¥å£: çº¦ 10-15 MB/s
- USB 3.0 æ¥å£: çº¦ 30-50 MB/s
- é«˜é€Ÿ SD å¡è¯»å¡å™¨: çº¦ 80-100 MB/s

**æç¤ºï¼š** ä½¿ç”¨ USB 3.0 è¯»å¡å™¨å¯æ˜¾è‘—æå‡é€Ÿåº¦

### æ ¡éªŒå¤±è´¥

å¦‚æœæ ¡éªŒå¤±è´¥ï¼Œå¯èƒ½åŸå› ï¼š
1. **SD å¡è´¨é‡é—®é¢˜** - å°è¯•æ›´æ¢ SD å¡
2. **è¯»å¡å™¨é—®é¢˜** - æ›´æ¢è¯»å¡å™¨æˆ– USB å£
3. **å†™å…¥ä¸­æ–­** - ç¡®ä¿å†™å…¥è¿‡ç¨‹ä¸è¢«ä¸­æ–­
4. **SD å¡æœ‰åå—** - ä½¿ç”¨ `badblocks` æ£€æŸ¥

```bash
# æ£€æŸ¥ SD å¡åå—ï¼ˆä¼šæ¸…é™¤æ•°æ®ï¼ï¼‰
sudo badblocks -wsv /dev/sdX
```

### SD å¡æœªè‡ªåŠ¨é…ç½®

1. æ£€æŸ¥ boot åˆ†åŒºæ˜¯å¦æœ‰ `userconf.txt` æˆ– `user-data`
   ```bash
   # é‡æ–°æ’å…¥ SD å¡å
   ls /media/$USER/bootfs/
   ```

2. ç¡®ä¿ SD å¡ä½¿ç”¨ `sync` å‘½ä»¤åŒæ­¥åæ‰æ‹”å‡º

3. ç¡®è®¤ä½¿ç”¨çš„ Pi OS ç‰ˆæœ¬æ”¯æŒ cloud-initï¼ˆ2022å¹´4æœˆåï¼‰

### æƒé™é”™è¯¯

```bash
# ç¡®ä¿è„šæœ¬å¯æ‰§è¡Œ
chmod +x *.sh

# å†™å…¥å¿…é¡»ä½¿ç”¨ sudo
sudo ./write-image.sh
```

### æ‰¾ä¸åˆ°é•œåƒæ–‡ä»¶

```bash
# ç¡®è®¤é•œåƒåœ¨ images/ ç›®å½•
ls -lh images/

# æ”¯æŒçš„æ ¼å¼ï¼š.img, .xz, .zip
```

### WiFi æ— æ³•è¿æ¥

**å¯¹äº Raspberry Pi OS Trixie (Debian 13)ï¼š**
- è„šæœ¬ä¼šåŒæ—¶åˆ›å»º `network-config` å’Œ `wpa_supplicant.conf`
- Trixie ä½¿ç”¨ NetworkManagerï¼Œä¼šè¯»å– `network-config`
- æ—§ç‰ˆæœ¬ä½¿ç”¨ wpa_supplicantï¼Œä¼šè¯»å– `wpa_supplicant.conf`

**æ£€æŸ¥æ¸…å•ï¼š**
1. ç¡®è®¤ SSID å’Œå¯†ç æ­£ç¡®ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰
2. æ£€æŸ¥ `WIFI_COUNTRY` è®¾ç½®æ­£ç¡®
3. ç¡®ä¿æ˜¯ 2.4GHz WiFiï¼ˆæ ‘è“æ´¾ 4B æ”¯æŒ 2.4GHz å’Œ 5GHzï¼‰
4. å¦‚æœ SSID åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œç¡®ä¿æ­£ç¡®è½¬ä¹‰

**éªŒè¯é…ç½®ï¼š**
```bash
# å†™å…¥åé‡æ–°æ’å…¥ SD å¡ï¼Œæ£€æŸ¥ boot åˆ†åŒº
ls /media/$USER/bootfs/ | grep -E "network-config|wpa_supplicant"

# åº”è¯¥çœ‹åˆ°ï¼š
# - network-config       (ç”¨äº NetworkManager/Trixie)
# - wpa_supplicant.conf  (ç”¨äºæ—§ç‰ˆæœ¬)
```

## éªŒè¯å†™å…¥ç»“æœ

å†™å…¥å®Œæˆåï¼Œé‡æ–°æ’å…¥ SD å¡æ£€æŸ¥ï¼š

```bash
# æŸ¥çœ‹ boot åˆ†åŒº
ls -la /media/$USER/bootfs/

# åº”è¯¥åŒ…å«ï¼š
# - userconf.txt         (ç”¨æˆ·é…ç½®)
# - user-data            (cloud-init é…ç½®)
# - ssh                  (SSH å¯ç”¨æ ‡å¿—)
# - network-config       (WiFi é…ç½® - Trixie/NetworkManager)
# - wpa_supplicant.conf  (WiFi é…ç½® - æ—§ç‰ˆæœ¬å…¼å®¹)
```

## å®‰å…¨ç‰¹æ€§

### æ™ºèƒ½è®¾å¤‡è¿‡æ»¤

è„šæœ¬ä¼šè‡ªåŠ¨è·³è¿‡ä»¥ä¸‹è®¾å¤‡ï¼Œé˜²æ­¢è¯¯æ“ä½œï¼š

âœ… **è‡ªåŠ¨è·³è¿‡ï¼š**
- ç³»ç»Ÿç›˜ï¼ˆæ ¹åˆ†åŒºæ‰€åœ¨ç£ç›˜ï¼‰
- æœ‰äº¤æ¢åˆ†åŒºçš„ç£ç›˜
- å®¹é‡è¶…è¿‡64GB çš„è®¾å¤‡
- æœ‰ 4 ä¸ªä»¥ä¸Šåˆ†åŒºçš„ç£ç›˜

**ç¤ºä¾‹è¾“å‡ºï¼š**
```
===== å¯ç”¨å­˜å‚¨è®¾å¤‡ =====

âš  è·³è¿‡ /dev/sda - ç³»ç»Ÿç›˜
âš  è·³è¿‡ /dev/sdb - å®¹é‡è¿‡å¤§ (119GB), æœ‰ 4 ä¸ªåˆ†åŒº

[1] /dev/sdc
    å¤§å°: 32G (32 GB)
    å‹å·: SanDisk Ultra
    çŠ¶æ€: æœªæŒ‚è½½
    åˆ†åŒº: 1 ä¸ª

è¯·é€‰æ‹©è®¾å¤‡ç¼–å· [1] (æˆ–è¾“å…¥ 'q' é€€å‡º):
```

### æ‰‹åŠ¨æŒ‡å®šè®¾å¤‡ï¼ˆé«˜çº§ï¼‰

å¦‚æœéœ€è¦å†™å…¥è¢«è¿‡æ»¤çš„è®¾å¤‡ï¼š

```bash
# è·³è¿‡å®‰å…¨æ£€æŸ¥ï¼Œç›´æ¥æŒ‡å®šè®¾å¤‡
sudo ./write-image.sh /dev/sdb

# ä¼šæ˜¾ç¤ºè­¦å‘Š
âš ï¸ ç›´æ¥æŒ‡å®šè®¾å¤‡æ¨¡å¼ï¼šå·²è·³è¿‡å®‰å…¨æ£€æŸ¥
```

**âš ï¸ è­¦å‘Šï¼š** æ­¤æ¨¡å¼ä¼šè·³è¿‡æ‰€æœ‰å®‰å…¨æ£€æŸ¥ï¼Œè¯·ç¡®ä¿æŒ‡å®šäº†æ­£ç¡®çš„è®¾å¤‡ï¼

## ä½¿ç”¨æç¤º

### äº¤äº’å¼è®¾å¤‡é€‰æ‹©ï¼ˆæ¨èï¼‰

```bash
sudo ./write-image.sh
```

è„šæœ¬ä¼šåˆ—å‡ºå®‰å…¨çš„è®¾å¤‡ä¾›é€‰æ‹©ï¼Œå¹¶è‡ªåŠ¨è¿‡æ»¤ï¼š
- âŒ ç³»ç»Ÿç›˜
- âŒ æœ‰äº¤æ¢åˆ†åŒºçš„ç£ç›˜
- âŒ å®¹é‡è¿‡å¤§çš„è®¾å¤‡ (>128GB)
- âŒ åˆ†åŒºè¿‡å¤šçš„ç£ç›˜ (>3ä¸ª)

åªæ˜¾ç¤ºå¯èƒ½æ˜¯ SD å¡/U ç›˜çš„è®¾å¤‡ã€‚

### æ‰‹åŠ¨æŒ‡å®šè®¾å¤‡ï¼ˆé«˜çº§ï¼‰

```bash
# è·³è¿‡å®‰å…¨æ£€æŸ¥
sudo ./write-image.sh /dev/sdX
```

**âš ï¸ è­¦å‘Šï¼š** è¯·ç¡®ä¿è®¾å¤‡å·æ­£ç¡®ï¼Œæ­¤æ¨¡å¼è·³è¿‡æ‰€æœ‰å®‰å…¨æ£€æŸ¥ï¼

### è„šæœ¬æƒé™è¯´æ˜

**verify-config.sh** - æ™®é€šç”¨æˆ·è¿è¡Œï¼ŒéªŒè¯é…ç½®
```bash
./verify-config.sh
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
éªŒè¯é…ç½®...
âœ“ ä¸»æœºå: pi4b
âœ“ ç”¨æˆ·å: pi
âœ“ é…ç½®éªŒè¯é€šè¿‡ï¼

â„¹ ä¸‹ä¸€æ­¥: sudo ./write-image.sh
```

**write-image.sh** - éœ€è¦ sudoï¼Œå†™å…¥ SD å¡
```bash
sudo ./write-image.sh
```

å¦‚æœå¿˜è®°ä½¿ç”¨ sudoï¼š
```
âœ— æ­¤è„šæœ¬éœ€è¦ root æƒé™
â„¹ è¯·ä½¿ç”¨: sudo ./write-image.sh
```

### è‡ªåŠ¨å®‰è£… pv

é¦–æ¬¡ä½¿ç”¨ `sudo ./write-image.sh` æ—¶ï¼Œä¼šè‡ªåŠ¨å®‰è£… `pv`ï¼ˆè¿›åº¦æ¡å·¥å…·ï¼‰ï¼š

```
=== RPI-Custom-Imager ===

â„¹ æœªæ£€æµ‹åˆ° pvï¼Œæ­£åœ¨è‡ªåŠ¨å®‰è£…...
Reading package lists... Done
âœ“ pv å®‰è£…æˆåŠŸ
```

ä¹‹åå°±æœ‰æ¼‚äº®çš„è¿›åº¦æ¡äº†ï¼š
```
4.00GiB 0:02:30 [27.3MiB/s] [============>       ] 67% ETA 0:01:15
```

### å…³äº Raspberry Pi OS Trixie

**Trixie (Debian 13)** æ˜¯è¾ƒæ–°ç‰ˆæœ¬ï¼Œä¸»è¦å˜åŒ–ï¼š
- ä½¿ç”¨ **NetworkManager** ç®¡ç†ç½‘ç»œï¼ˆè€Œé wpa_supplicantï¼‰
- WiFi é…ç½®ä½¿ç”¨ `network-config` æ–‡ä»¶ï¼ˆnetplan æ ¼å¼ï¼‰
- ä»å‘åå…¼å®¹ `wpa_supplicant.conf`

æœ¬è„šæœ¬ä¼šåŒæ—¶åˆ›å»ºä¸¤ç§é…ç½®æ–‡ä»¶ï¼Œç¡®ä¿åœ¨ä»»ä½•ç‰ˆæœ¬éƒ½èƒ½å·¥ä½œã€‚

## License

MIT License
